[Unit]
Description=Minecraft Server %i
After=network.target

[Service]
WorkingDirectory={{ minecraft_home}}/%i

# Solves the issue where the minecraft server will endlessly restart itself
# For more info, see:
# https://askubuntu.com/questions/953920/systemctl-service-timed-out-during-start
Type=simple

# Users Database is not available from within the unit, only root and minecraft
# is available, everybody else is nobody
PrivateUsers=true

User={{ minecraft_user }}
Group={{ minecraft_group }}

# Read only mapping of /usr /boot and /etc
ProtectSystem=full

# /home, /root and /run/user seem to be empty from within the unit. It is
# recommended to enable this setting for all long-running services (in
# particular network-facing ones).
ProtectHome=true

# /proc/sys, /sys, /proc/sysrq-trigger, /proc/latency_stats, /proc/acpi,
# /proc/timer_stats, /proc/fs and /proc/irq will be read-only within the unit.
# It is recommended to turn this on for most services.
# Implies MountFlags=slave
ProtectKernelTunables=true

# Block module system calls, also /usr/lib/modules. It is recommended to turn
# this on for most services that do not need special file systems or extra
# kernel modules to work
# Implies NoNewPrivileges=yes
ProtectKernelModules=true

# It is recommended to turn this on for most services.
# Implies MountAPIVFS=yes
ProtectControlGroups=true

ExecStart=/usr/local/bin/minecraft-server %i
ExecStop=/usr/local/bin/minecraft-server-stop %i
Restart=always

[Install]
WantedBy=default.target
